# Claude Code - Supabase Quick Reference

## âš¡ Commands I Should Use

### For ALL migration operations:
```bash
./scripts/safe-migration.sh [command]
```

### Available commands:
- `check` - Verify connection and link status
- `list` - List all migrations (local and remote)
- `create <name>` - Create new migration file
- `push` - Push pending migrations to remote

### Example workflow:
```bash
# 1. Check connection
./scripts/safe-migration.sh check

# 2. Create migration
./scripts/safe-migration.sh create add_loyalty_rewards

# 3. Edit: supabase/migrations/XXX_add_loyalty_rewards.sql

# 4. Push to remote
./scripts/safe-migration.sh push
```

## ğŸš¨ Critical Rules

1. **ALWAYS use the safe script** - Never use `supabase` commands directly
2. **ALWAYS wait 3+ seconds** between script calls
3. **NEVER use direct psql** in loops or rapid succession
4. **NEVER change credentials** without user confirmation

## âœ… Safe Pattern

```bash
# Check first
./scripts/safe-migration.sh check

# Wait 3 seconds
sleep 3

# Do the operation
./scripts/safe-migration.sh [operation]

# Wait 3 seconds
sleep 3

# Verify
./scripts/safe-migration.sh list
```

## âŒ Dangerous Patterns to Avoid

```bash
# DON'T do this:
supabase db push  # Missing rate limiting

# DON'T do this:
psql "$DATABASE_URL" -f migration.sql  # Direct connection

# DON'T do this:
supabase db push && supabase migration list  # Too fast

# DON'T do this:
for file in *.sql; do psql "$DATABASE_URL" -f "$file"; done  # IP ban guaranteed
```

## ğŸ”‘ Credentials (Already Set)

All credentials are in `.env`:
- Password: `Flipperspender12!!` (correct one!)
- Project: `zwcwrwctomlnvyswovhb`
- Access Token: `sbp_58af2b3d8ab72fa2d9c2950fafcd5cf9477a4b10`

**Never modify these unless user explicitly requests it!**

## ğŸ“ Project Status

- âœ… CLI linked to remote project
- âœ… Access token configured
- âœ… Safe script ready to use
- âš ï¸ Migrations 073-080 pending push (user to decide)

## ğŸ› If Something Goes Wrong

```bash
# Reset and reconnect
rm -rf .supabase && ./scripts/safe-migration.sh check

# If rate limited: WAIT 15-30 minutes before retry
```

## ğŸ“š Full Documentation

- Quick Start: `SUPABASE_SETUP.md`
- Complete Guide: `docs/SUPABASE_WORKFLOWS.md`

---

**Remember:** Patience prevents bans. Always use delays! â±ï¸
