# Complete Order Workflow Analysis
## Apple Engineering + Complete Staff Toolset

---

## The 4 Order Types - Complete Picture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Order Type   â”‚ Customer Journey                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Walk-in      â”‚ Customer walks in â†’ Buys â†’ Pays â†’ Leaves              â”‚
â”‚              â”‚ (Instant POS sale, no fulfillment)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Pickup       â”‚ Customer orders online â†’ Staff prepares â†’              â”‚
â”‚              â”‚ Customer picks up at store â†’ Complete                  â”‚
â”‚              â”‚ (Local, same-day or next-day)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Delivery     â”‚ Customer orders online â†’ Staff prepares â†’              â”‚
â”‚              â”‚ Driver delivers locally â†’ Complete                     â”‚
â”‚              â”‚ (Local delivery within service area)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Shipping     â”‚ Customer orders online â†’ Staff packs â†’                 â”‚
â”‚              â”‚ USPS/FedEx ships â†’ Delivered â†’ Complete               â”‚
â”‚              â”‚ (Nationwide shipping, tracking, labels)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Staff Needs - Complete Toolset

### What Staff Actually Need to See:

âœ… **Active Orders** (needs their attention)
âœ… **Today's History** (for customer service, quick lookups)
âœ… **Complete History** (returns, disputes, reporting)
âœ… **Shipping Tools** (labels, tracking, packing slips)

---

## Orders Screen - Redesigned Navigation

### Left Sidebar:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ACTIVE ORDERS            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”” Needs Action       3  â”‚ â† Smart filter: What needs staff NOW
â”‚  ğŸ“¦ Being Prepared     5  â”‚ â† Orders staff are working on
â”‚                           â”‚
â”‚  ORDER TYPES              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ Pickup             2  â”‚ â† Only active pickup orders
â”‚  ğŸš— Delivery           1  â”‚ â† Only active delivery orders
â”‚  ğŸ“® Shipping           2  â”‚ â† Only active shipping orders
â”‚                           â”‚
â”‚  HISTORY                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’° Walk-in Today    198  â”‚ â† Today's POS sales
â”‚  ğŸ“… All Orders       247  â”‚ â† Complete history
â”‚  ğŸ” Search Orders         â”‚ â† Find any order ever
â”‚                           â”‚
â”‚  REPORTS                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š Today's Sales         â”‚
â”‚  ğŸ“ˆ This Week             â”‚
â”‚  ğŸ—“ï¸ This Month            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Filters Explained:

**ğŸ”” Needs Action** (Priority #1)
- Pickup: `pending` or `ready` (needs staff to prepare or hand off)
- Delivery: `pending` or `out_for_delivery` (needs prep or delivery confirmation)
- Shipping: `pending` or `ready_to_ship` (needs packing or label printing)
- Walk-in: NEVER shows here (auto-completed)

**ğŸ“¦ Being Prepared**
- All orders with status `preparing`
- Shows what staff is actively working on
- Useful for teamwork: "I'm already packing that order"

**ğŸ’° Walk-in Today**
- All POS sales from today
- For customer service: "Did you buy this today?"
- For reporting: "How many walk-in sales today?"
- All auto-completed, no action needed

**ğŸ“… All Orders**
- Complete history
- Searchable by date range, customer, order number
- For returns, disputes, inventory audits

---

## Shipping Orders - Complete Workflow

### Status Progression:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PENDING â”‚â†’ â”‚ PREPARING  â”‚â†’ â”‚ READY_TO_SHIP  â”‚â†’ â”‚   SHIPPED    â”‚â†’ â”‚ DELIVERED â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  (Orange)      (Blue)            (Purple)             (Purple)           (Green)

   Staff           Staff            Staff             Auto from          Auto from
   clicks       packs items      prints label        tracking API       tracking API
   "Prepare"    + marks ready    + ships package
```

### Shipping Order Detail View:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† Orders                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Mike Thompson                                          â”‚
â”‚  Shipping Order â€¢ #SHP-20251118-0045                    â”‚
â”‚  ğŸŸ£ READY TO SHIP                                       â”‚
â”‚                                                         â”‚
â”‚  SHIPPING ADDRESS                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Mike Thompson                                     â”‚ â”‚
â”‚  â”‚ 123 Main Street, Apt 4B                          â”‚ â”‚
â”‚  â”‚ New York, NY 10001                               â”‚ â”‚
â”‚  â”‚ (212) 555-0199                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”‚  ITEMS (3) - Total Weight: 0.5 lbs                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âœ“ Blue Dream (3.5g)              $45.00          â”‚ â”‚
â”‚  â”‚ âœ“ Gummies (100mg)                $28.00          â”‚ â”‚
â”‚  â”‚ âœ“ Pre-rolls (5pk)                $35.00          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”‚  PACKAGE DETAILS                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Weight: 0.5 lbs                                   â”‚ â”‚
â”‚  â”‚ Dimensions: 8" Ã— 6" Ã— 4" (auto-calculated)       â”‚ â”‚
â”‚  â”‚ Service: USPS Priority Mail                      â”‚ â”‚
â”‚  â”‚ Est. Delivery: Nov 20-22                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“ â”‚
â”‚  â”ƒ  ğŸ“„ Print Shipping Label + Packing Slip         â”ƒ â”‚ â† Primary action
â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”› â”‚
â”‚                                                         â”‚
â”‚  [ ğŸ“¦ Mark as Shipped ]                                 â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### After Clicking "Print Shipping Label":

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SHIPPING LABEL READY                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  ğŸ“„ Documents Generated:                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âœ“ Shipping Label (4x6)                            â”‚ â”‚
â”‚  â”‚ âœ“ Packing Slip                                    â”‚ â”‚
â”‚  â”‚ âœ“ Return Label (optional)                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”‚  Tracking Number: 9400111899562843657891                â”‚
â”‚  Postage Paid: $8.95                                    â”‚
â”‚                                                         â”‚
â”‚  [ ğŸ–¨ï¸ Print Labels ]  [ ğŸ“§ Email to Customer ]         â”‚
â”‚                                                         â”‚
â”‚  After printing and affixing label:                     â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“ â”‚
â”‚  â”ƒ  âœ“ Confirm Package Shipped                       â”ƒ â”‚
â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”› â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Shipped Order Detail:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† Orders                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Mike Thompson                                          â”‚
â”‚  Shipping Order â€¢ #SHP-20251118-0045                    â”‚
â”‚  ğŸŸ£ IN TRANSIT                                          â”‚
â”‚                                                         â”‚
â”‚  TRACKING                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Tracking: 9400111899562843657891                 â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚ â— Shipped from Charlotte, NC - Nov 18, 2:30 PM  â”‚ â”‚
â”‚  â”‚ â— In Transit - Nov 19, 8:00 AM                  â”‚ â”‚
â”‚  â”‚ â— Out for Delivery - Nov 20, 9:00 AM            â”‚ â”‚
â”‚  â”‚ â—‹ Expected Delivery - Nov 20, 5:00 PM           â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚ [ ğŸ”— View Full Tracking on USPS.com ]            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”‚  PACKAGE DETAILS                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Service: USPS Priority Mail                      â”‚ â”‚
â”‚  â”‚ Shipped: Nov 18, 2024 at 2:30 PM                â”‚ â”‚
â”‚  â”‚ Shipped by: Sarah Johnson                        â”‚ â”‚
â”‚  â”‚ Postage: $8.95                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”‚  [ ğŸ“„ Reprint Label ]  [ ğŸ“§ Resend Tracking ]          â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Shipping Integration - Technical Details

### Supported Carriers:

**Phase 1 (Launch):**
- USPS (Priority Mail, First Class, Priority Express)
- Automatic tracking updates via USPS API

**Phase 2 (Future):**
- FedEx
- UPS
- DHL

### Integration with Shippo/EasyPost:

```typescript
// Example: Print shipping label
async function createShippingLabel(orderId: string) {
  const order = await getOrderById(orderId)

  // 1. Create shipment with Shippo API
  const shipment = await shippo.createShipment({
    addressFrom: {
      name: "WhaleTools Charlotte",
      street1: "123 Store St",
      city: "Charlotte",
      state: "NC",
      zip: "28202",
      country: "US"
    },
    addressTo: {
      name: order.shipping_name,
      street1: order.shipping_address_line1,
      street2: order.shipping_address_line2,
      city: order.shipping_city,
      state: order.shipping_state,
      zip: order.shipping_zip,
      country: "US"
    },
    parcels: [{
      length: "8",
      width: "6",
      height: "4",
      weight: "0.5",
      distance_unit: "in",
      mass_unit: "lb"
    }]
  })

  // 2. Buy cheapest label (or let staff choose)
  const rate = shipment.rates.find(r => r.servicelevel.token === "usps_priority")
  const transaction = await shippo.createTransaction(rate.object_id)

  // 3. Save tracking number to order
  await updateOrder(orderId, {
    tracking_number: transaction.tracking_number,
    tracking_url: transaction.tracking_url_provider,
    shipping_label_url: transaction.label_url,
    postage_paid: transaction.rate,
    status: 'shipped',
    shipped_at: new Date(),
    shipped_by_user_id: currentUser.id
  })

  // 4. Notify customer
  await sendEmail({
    to: order.customer_email,
    subject: `Your order #${order.order_number} has shipped!`,
    template: 'order-shipped',
    data: {
      trackingNumber: transaction.tracking_number,
      trackingUrl: transaction.tracking_url_provider,
      estimatedDelivery: transaction.estimated_delivery
    }
  })

  // 5. Return label URL for printing
  return {
    labelUrl: transaction.label_url,
    packingSlipUrl: generatePackingSlip(order),
    trackingNumber: transaction.tracking_number
  }
}
```

### Automatic Tracking Updates:

```typescript
// Webhook from Shippo for tracking updates
app.post('/api/webhooks/shippo', async (req) => {
  const event = req.body

  if (event.event === 'track_updated') {
    const tracking = event.data

    // Find order by tracking number
    const order = await findOrderByTracking(tracking.tracking_number)

    // Update order status based on tracking
    if (tracking.status === 'DELIVERED') {
      await updateOrder(order.id, {
        status: 'completed',
        delivered_at: new Date(tracking.status_date),
        delivery_confirmed_by: 'usps_tracking'
      })

      // Notify customer
      await sendEmail({
        to: order.customer_email,
        subject: `Your order has been delivered!`,
        template: 'order-delivered'
      })
    }

    // Log tracking event for customer to see
    await createTrackingEvent({
      order_id: order.id,
      status: tracking.status,
      location: tracking.location,
      timestamp: tracking.status_date,
      message: tracking.status_details
    })
  }
})
```

---

## Order History - Smart Search & Filters

### Search Interface:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ALL ORDERS                                   ğŸ”        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Search by order #, customer, phone, email...    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  FILTERS:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ All Types â–¼â”‚  Any Date â–¼â”‚ All Staff â–¼â”‚ Export â–¼  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  Showing 247 orders â€¢ Total: $12,459.87                â”‚
â”‚                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Today - Nov 18, 2024                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ #WLK-001 â€¢ 10:45 AM â€¢ Walk-in  â€¢ $45  â€¢ âœ“ Paid  â”‚ â”‚
â”‚  â”‚ John Smith                                        â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ #PK-0234 â€¢ 10:30 AM â€¢ Pickup   â€¢ $89  â€¢ â± Ready â”‚ â”‚
â”‚  â”‚ Sarah Johnson                                     â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ #SHP-0045 â€¢ 9:15 AM â€¢ Shipping â€¢ $108 â€¢ ğŸ“¦ Ship. â”‚ â”‚
â”‚  â”‚ Mike Thompson                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”‚  Yesterday - Nov 17, 2024                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ #WLK-198 â€¢ 6:45 PM â€¢ Walk-in   â€¢ $72  â€¢ âœ“ Paid  â”‚ â”‚
â”‚  â”‚ ...                                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Quick Stats at Top:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TODAY'S SUMMARY                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’° $8,910.00    198 Walk-in                           â”‚
â”‚  ğŸ“ $1,290.00     15 Pickup                            â”‚
â”‚  ğŸš—   $890.00      8 Delivery                          â”‚
â”‚  ğŸ“®   $369.87      4 Shipping                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Total: $11,459.87 â€¢ 225 orders                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Schema - Complete

```sql
CREATE TABLE orders (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  order_number VARCHAR(50) UNIQUE NOT NULL,

  -- Order Type (NEW)
  order_type VARCHAR(20) NOT NULL, -- 'walk_in', 'pickup', 'delivery', 'shipping'

  -- Customer
  customer_id UUID REFERENCES customers(id),
  customer_email VARCHAR(255),
  customer_phone VARCHAR(20),

  -- Location
  vendor_id UUID NOT NULL REFERENCES vendors(id),
  pickup_location_id UUID REFERENCES locations(id), -- Where order is fulfilled from

  -- Shipping Address (for shipping orders only)
  shipping_name VARCHAR(255),
  shipping_address_line1 VARCHAR(255),
  shipping_address_line2 VARCHAR(255),
  shipping_city VARCHAR(100),
  shipping_state VARCHAR(50),
  shipping_zip VARCHAR(20),
  shipping_country VARCHAR(2) DEFAULT 'US',
  shipping_phone VARCHAR(20),

  -- Status Workflow
  status VARCHAR(30) NOT NULL,
  -- walk_in: 'completed'
  -- pickup: 'pending', 'preparing', 'ready', 'completed', 'cancelled'
  -- delivery: 'pending', 'preparing', 'out_for_delivery', 'completed', 'cancelled'
  -- shipping: 'pending', 'preparing', 'ready_to_ship', 'shipped', 'in_transit', 'delivered', 'cancelled'

  -- Payment
  payment_status VARCHAR(30) NOT NULL,
  payment_method VARCHAR(50),

  -- Money
  subtotal DECIMAL(10,2) NOT NULL,
  tax_amount DECIMAL(10,2) NOT NULL,
  discount_amount DECIMAL(10,2) DEFAULT 0,
  shipping_cost DECIMAL(10,2) DEFAULT 0, -- For shipping orders
  total_amount DECIMAL(10,2) NOT NULL,

  -- Fulfillment Tracking
  prepared_by_user_id UUID REFERENCES users(id),
  prepared_at TIMESTAMP,

  -- Pickup/Delivery Specific
  ready_at TIMESTAMP, -- When order was marked ready
  notified_at TIMESTAMP, -- When customer was notified
  picked_up_at TIMESTAMP,
  delivered_at TIMESTAMP,
  delivered_by_user_id UUID REFERENCES users(id),

  -- Shipping Specific
  tracking_number VARCHAR(100),
  tracking_url TEXT,
  shipping_label_url TEXT,
  shipping_carrier VARCHAR(50), -- 'usps', 'fedex', 'ups'
  shipping_service VARCHAR(100), -- 'priority_mail', 'ground', etc.
  postage_paid DECIMAL(10,2),
  package_weight DECIMAL(10,3), -- in lbs
  package_length DECIMAL(10,2), -- in inches
  package_width DECIMAL(10,2),
  package_height DECIMAL(10,2),
  shipped_at TIMESTAMP,
  shipped_by_user_id UUID REFERENCES users(id),
  estimated_delivery_date DATE,

  -- Timestamps
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  completed_at TIMESTAMP,

  -- Notes
  customer_notes TEXT,
  staff_notes TEXT,

  -- Indexes for performance
  INDEX idx_order_type (order_type),
  INDEX idx_status (status),
  INDEX idx_location (pickup_location_id),
  INDEX idx_created (created_at DESC),
  INDEX idx_tracking (tracking_number)
);

-- Tracking Events (for shipping orders)
CREATE TABLE order_tracking_events (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  order_id UUID NOT NULL REFERENCES orders(id),
  status VARCHAR(50) NOT NULL,
  location VARCHAR(255),
  message TEXT,
  timestamp TIMESTAMP NOT NULL,
  created_at TIMESTAMP DEFAULT NOW(),

  INDEX idx_order (order_id),
  INDEX idx_timestamp (timestamp DESC)
);
```

---

## Migration Strategy

### Step 1: Add New Fields
```sql
-- Add order_type column
ALTER TABLE orders ADD COLUMN order_type VARCHAR(20);

-- Add shipping fields
ALTER TABLE orders ADD COLUMN shipping_name VARCHAR(255);
ALTER TABLE orders ADD COLUMN shipping_address_line1 VARCHAR(255);
ALTER TABLE orders ADD COLUMN shipping_address_line2 VARCHAR(255);
ALTER TABLE orders ADD COLUMN shipping_city VARCHAR(100);
ALTER TABLE orders ADD COLUMN shipping_state VARCHAR(50);
ALTER TABLE orders ADD COLUMN shipping_zip VARCHAR(20);
ALTER TABLE orders ADD COLUMN shipping_country VARCHAR(2) DEFAULT 'US';
ALTER TABLE orders ADD COLUMN shipping_phone VARCHAR(20);
ALTER TABLE orders ADD COLUMN tracking_number VARCHAR(100);
ALTER TABLE orders ADD COLUMN tracking_url TEXT;
ALTER TABLE orders ADD COLUMN shipping_label_url TEXT;
ALTER TABLE orders ADD COLUMN shipping_carrier VARCHAR(50);
ALTER TABLE orders ADD COLUMN shipping_service VARCHAR(100);
ALTER TABLE orders ADD COLUMN postage_paid DECIMAL(10,2);
ALTER TABLE orders ADD COLUMN shipping_cost DECIMAL(10,2) DEFAULT 0;
ALTER TABLE orders ADD COLUMN package_weight DECIMAL(10,3);
ALTER TABLE orders ADD COLUMN package_length DECIMAL(10,2);
ALTER TABLE orders ADD COLUMN package_width DECIMAL(10,2);
ALTER TABLE orders ADD COLUMN package_height DECIMAL(10,2);
ALTER TABLE orders ADD COLUMN shipped_at TIMESTAMP;
ALTER TABLE orders ADD COLUMN shipped_by_user_id UUID REFERENCES users(id);
ALTER TABLE orders ADD COLUMN estimated_delivery_date DATE;
ALTER TABLE orders ADD COLUMN delivered_at TIMESTAMP;
ALTER TABLE orders ADD COLUMN delivered_by_user_id UUID REFERENCES users(id);
ALTER TABLE orders ADD COLUMN prepared_by_user_id UUID REFERENCES users(id);
ALTER TABLE orders ADD COLUMN prepared_at TIMESTAMP;
ALTER TABLE orders ADD COLUMN ready_at TIMESTAMP;
ALTER TABLE orders ADD COLUMN notified_at TIMESTAMP;
ALTER TABLE orders ADD COLUMN picked_up_at TIMESTAMP;
ALTER TABLE orders ADD COLUMN staff_notes TEXT;
```

### Step 2: Migrate Existing Data
```sql
-- Set order_type based on delivery_type
UPDATE orders
SET order_type = CASE
  WHEN delivery_type = 'instore' THEN 'walk_in'
  WHEN delivery_type = 'pickup' THEN 'pickup'
  WHEN delivery_type = 'delivery' THEN 'delivery'
  ELSE 'walk_in'
END;

-- Auto-complete all walk-in orders
UPDATE orders
SET
  status = 'completed',
  completed_at = created_at
WHERE order_type = 'walk_in'
  AND payment_status = 'paid'
  AND status != 'completed';

-- Update status terminology for pickup/delivery
UPDATE orders
SET status = CASE
  WHEN status = 'processing' THEN 'preparing'
  ELSE status
END
WHERE order_type IN ('pickup', 'delivery', 'shipping');
```

### Step 3: Create Tracking Events Table
```sql
CREATE TABLE order_tracking_events (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  order_id UUID NOT NULL REFERENCES orders(id) ON DELETE CASCADE,
  status VARCHAR(50) NOT NULL,
  location VARCHAR(255),
  message TEXT,
  timestamp TIMESTAMP NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_tracking_order ON order_tracking_events(order_id);
CREATE INDEX idx_tracking_timestamp ON order_tracking_events(timestamp DESC);
```

---

## POS Updates - Auto-Complete Walk-in

### Update POS Sale Creation:

```typescript
// In src/services/pos.service.ts or wherever POS creates orders

async function createPOSSale(saleData: POSSaleData) {
  const order = await supabase
    .from('orders')
    .insert({
      order_type: 'walk_in', // NEW: Always walk_in for POS
      status: 'completed', // NEW: Auto-complete
      payment_status: 'paid', // Payment succeeded
      customer_id: saleData.customer_id,
      pickup_location_id: saleData.location_id, // Where sale happened
      vendor_id: saleData.vendor_id,
      subtotal: saleData.subtotal,
      tax_amount: saleData.tax,
      discount_amount: saleData.discount,
      total_amount: saleData.total,
      payment_method: saleData.payment_method,
      completed_at: new Date(), // NEW: Mark completed timestamp
      created_at: new Date(),
      updated_at: new Date(),
    })
    .select()
    .single()

  // Create order items...

  return order
}
```

---

## Staff Tools Summary

### What Staff Can Do:

**Active Orders Tab:**
- See only orders that need action
- Quick filters by order type
- One-click status updates
- Print labels/packing slips

**History Tab:**
- Search any order
- Filter by date, type, staff
- Export for reports
- Customer service lookups

**Shipping Tools:**
- Print USPS labels in one click
- Track packages automatically
- Reprint labels if needed
- See delivery status

**Reports:**
- Daily sales by type
- Weekly/monthly summaries
- Staff performance
- Inventory impact

---

## Implementation Priority - Revised

### Phase 1: Core Workflow (This Week)
1. âœ… Add `order_type` field to database
2. âœ… Migrate existing data
3. âœ… Update POS to create `walk_in` orders (auto-complete)
4. âœ… Add "Needs Action" smart filter
5. âœ… Add "Being Prepared" filter
6. âœ… Add "Walk-in Today" history view
7. âœ… Update order detail views with order type badges

### Phase 2: Shipping Integration (Next Week)
1. âœ… Add shipping fields to database
2. âœ… Integrate Shippo API
3. âœ… Build label printing UI
4. âœ… Add tracking webhook
5. âœ… Auto-update order status from tracking
6. âœ… Customer email notifications

### Phase 3: Enhanced Features (Following Weeks)
1. â³ Packing slip generation
2. â³ Return labels
3. â³ Multi-package shipments
4. â³ International shipping
5. â³ Delivery driver app
6. â³ Customer delivery tracking page

---

*"Staff should spend their time helping customers, not managing software."* - Apple Design Principle
